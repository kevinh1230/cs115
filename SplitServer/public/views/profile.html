<div>
    <alert ng-if="message != null" type="{{message.type}}" close="clearMessage()">{{message.text}}</alert>
    <div class="col-sm-6 jumbotron">
        <h3>Profile</h3>
		<label>First Name: {{user.firstName}}</label><br/>
		<label>List Name:  {{user.lastName}}</label><br/>
		<label>Username:   {{user.username}}</label><br/>
		<label>Password:   {{user.password}}</label><br/>
		<label>Email:      {{user.email}}</label><br/>
		<label>Id:         {{user._id}}</label><br/>
        <label>Friends:    </label>
        <label ng-repeat="friend in user.friends"> "{{friend.username}}"&nbsp;</label><br/>
        <label>Friend Requests:  </label>
        <label ng-repeat="friend in user.requests"> "{{friend.username}}"&nbsp;</label><br/>
        <label>Requested Friend: </label>
        <label ng-repeat="friend in user.requested"> "{{friend.username}}"&nbsp;</label><br/>
        <form>
            <input type="text" ng-model="aFriend" placeholder="Add Friend", require/>
            <button class="btn-default btn" ng-click="addFriend(aFriend)">Add</button>
        </form>
        <form>
            <input type="text" ng-model="dFriend" placeholder="Delete Friend", require/>
            <button class="btn-default btn" ng-click="deleteFriend(dFriend)">Delete</button>
        </form>
        <br>
        <label>Owned Bills: {{user.ownedBills}}</label><br/>
        <label>Charged Bills: {{user.chargedBills}}</label><br/>
		<button class="btn-default btn" ng-click="logout()">Logout</button>
    </div>
    <div class="col-sm-6 jumbotron">
        <h3>Friend Request</h3>
        <div ng-repeat="friend in user.requests">
            <label>{{friend.username}}   <button ng-click="acceptFriend(friend)">Accept</button></label>
        </div> <br>
        <h3>Bills Owned</h3>
        <div ng-repeat="bill in ownedBills">
            <label>Subject: {{bill.subject}}</label><br/>
            <label>Ammount: {{bill.ammount}}</label><br/>
            <label>Debters: {{bill.debters}}</label><br/>
            <label>Unpaid:  </label>
            <label ng-repeat="friend in bill.unpaid">"{{friend.username}}"&nbsp;</label><br/>
            <label>Paid:    </label>
            <label ng-repeat="friend in bill.paid">"{{friend.username}}"&nbsp;</label><br/>
        </div><br>
        <h3>Bills Charged</h3>
        <div ng-repeat="bill in chargedBills">
            <label>Subject: {{bill.subject}}</label><br/>
            <label>Amount: {{bill.ammount}}</label><br/>
            <label>Creator: {{bill.owner.username}}</label><br/>
            <label>Debters: {{bill.debters}}</label><br/>
            <label>Unpaid:  </label>
            <label ng-repeat="friend in bill.unpaid">"{{friend.username}}"&nbsp;</label><br/>
            <label>Paid:    </label>
            <label ng-repeat="friend in bill.paid">"{{friend.username}}"&nbsp;</label><br/>
            <button ng-click="payBill(bill)">Pay</button>
        </div>

    </div>
</div>

<body class="list-group" >
  <div ng-controller="addFriend" class = "floatright">
    <script type="text/ng-template" id="addFriend.html">
      <div class="modal-body">
      <h3>Add a friend</h3>
        <form name = "addFriendForm" novalidate ng-submit="addFriendForm.$valid">
          <fieldset class="form-group">
            <input ng-model = "aFriend" class="form-control" type = "text" placeholder="Username" title=" Username" required />
          </fieldset>
          <button class="btn btn-primary" ng-click="addFriend(aFriend)">OK</button>
        </form>
      </div>

    <h3>Friend Requests</h3>
    <div ng-repeat="friend in user.requests">
        <label>{{friend.username}}   <button ng-click="acceptFriend(friend)">Accept</button></label>
    </div> <br>

      <div class="modal-footer">
          <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
      </div>
    </script>

    <button class="btn btn-default" ng-click="openAddFriend()">Friends</button>
  </div> 

<div ng-controller="createBill" class = "floatright">
  <script type="text/ng-template" id="createBill.html">
  <div class="modal-header">
    <h3 class="modal-title">Create Bill</h3>
  </div>
  <div class="modal-body">
    <form name = "createBillForm" >

      <div class="form-group">
        <label>Subject/Description</label>
        <input type="text" class="form-control" placeholder="What does the bill regard?" ng-model="subject", require>
      </div>
      <div class="form-group">
        <label>Ammount</label>
        <input type="text" class="form-control" placeholder="How much money?" ng-model="ammount", require>
      </div>
      <div class="form-group">
        <label>People to charge</label>
        <!--<input typeahead="friend as friend.username for friend in friends | filter:$viewValue | limitTo:8" type="text" class="form-control" placeholder="Who do you want to charge?" ng-model="debters", require> -->
        <tags-input ng-model="debterList" add-on-enter="true" add-on-space="true" on-tag-added="verifyTag($tag)">
          <auto-complete source="loadFriends($query)" highlight-matched-text="true" min-length="1" load-on-empty="true"></auto-complete>
        </tags-input>
      </div>

    </form>
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary" ng-click="createBill(subject, ammount, debters)">Create Bill</button>
    <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
  </div>
  </script>

  <button class="btn btn-default" ng-click="openCreateBill()">Create Bill</button>
</div>

<section class="tab" ng-controller = "ProfileController as tab" >
  <ul class="nav nav-pills" >
    <li ng-class="{ active: tab.isSet(1) }" >
      <a href ng-click = "tab.setTab(1)">Bills to pay</a></li>
    <li ng-class="{ active: tab.isSet(2) }" >
      <a href ng-click = "tab.setTab(2)">Bills I created</a></li>
    <li ng-class="{ active: tab.isSet(3) }" >
      <a href ng-click = "tab.setTab(3)">Bills I paid</a></li>
  </ul>
  <div ng-show = "tab.isSet(1)">
    <div ng-controller="payBillModal">
      <blockquote>
        <div ng-repeat = "bill in chargedBills">
          <script type="text/ng-template" id="payBillModal.html">
            <div class="modal-header">
              <h3 class="modal-title">Pay Bill</h3>
            </div>
            <div class="modal-body">
              <label>Amount: {{bill.ammount}}</label><br/>
              <label>Creator: {{bill.owner.username}}</label><br/>
              <label>Debters: {{bill.debters}}</label><br/>
              <label>Unpaid:  </label>
              <label ng-repeat="friend in bill.unpaid">"{{friend.username}}"&nbsp;</label><br/>
              <label>Paid:    </label>
              <label ng-repeat="friend in bill.paid">"{{friend.username}}"&nbsp;</label><br/>
              <button ng-click="payBill(bill)">Pay</button>
              <form name = "payBillForm" novalidate ng-submit="payBillForm.$valid">
                <fieldset class="form-group">
                  <input ng-model = "pay.status" class="form-control" type = "text" placeholder="Status" title=" status" required />
                </fieldset>
                <fieldset class="form-group">
                  <input ng-model = "pay.method" class="form-control" type = "text" placeholder="Pay Method" title=" payMethod" required />
                </fieldset>
              </form>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" ng-click="ok()">Pay Bill</button>
              <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
            </div>
          </script>
          <a href ng-click="openPayBill(bill)" ng-show="checkUnpaid(user,bill)"><label>{{bill.subject}} - {{bill.ammount | currency}}</label></a>
        </div>
      </blockquote>
    </div>
  </div>
  <div ng-show = "tab.isSet(2)">
    <div ng-controller="ownedBills">
      <blockquote>
        <div ng-repeat="bill in ownedBills">
          <script type="text/ng-template" id="ownedBills.html">
            <div class="modal-header">
              <h3 class="modal-title">Pay Bill</h3>
            </div>
            <div class="modal-body">

            <label>Amount: {{bill.ammount}}</label><br/>
            <label>Creator: {{bill.owner.username}}</label><br/>
            <label>Debters: {{bill.debters}}</label><br/>
            <label>Unpaid:  </label>
            <label ng-repeat="friend in bill.unpaid">"{{friend.username}}"&nbsp;</label><br/>
            <label>Paid:    </label>
            <label ng-repeat="friend in bill.paid">"{{friend.username}}"&nbsp;</label><br/>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" ng-click="ok()">OK</button>
            </div>
          </script>
          <a href ng-click="openOwnedBill(bill)"><label>{{bill.subject}} - {{bill.ammount | currency}}</label></a>
        </div>
      </blockquote>
    </div>
  </div>
  <div ng-show = "tab.isSet(3)">
    <div ng-controller="paidBills">
      <blockquote>
        <div ng-repeat="bill in chargedBills">
          <script type="text/ng-template" id="paidBills.html">
            <div class="modal-header">
              <h3 class="modal-title">Paid</h3>
            </div>
            <div class="modal-body">
            <label>Amount: {{bill.ammount}}</label><br/>
            <label>Creator: {{bill.owner.username}}</label><br/>
            <label>Debters: {{bill.debters}}</label><br/>
            <label>Unpaid:  </label>
            <label ng-repeat="friend in bill.unpaid">"{{friend.username}}"&nbsp;</label><br/>
            <label>Paid:    </label>
            <label ng-repeat="friend in bill.paid">"{{friend.username}}"&nbsp;</label><br/>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" ng-click="ok()">OK</button>
            </div>
          </script>
          <a href ng-click="openPaidBill(bill)" ng-hide="checkUnpaid(user,bill)"><label>{{bill.subject}} - {{bill.ammount | currency}}</label></a>
        </div>
      </blockquote>
    </div>
  </div>
</section>
</body>
